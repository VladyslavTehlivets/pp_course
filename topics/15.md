Pliki i funkcje wejścia/wyjścia
=========================

Otwieranie i zamykanie pliku
-------------------------

Czytanie i zapisywanie do pliku
wymaga jego uprzedniego otwarcia.
Plik możemy otworzyć funkcją
`fopen`, której musimy podać dwa argumenty:

  * ścieżkę do pliku w postaci napisu
    np. `"plik.txt"`, `"/etc/fstab"`, `"C:\CONFIG.SYS"`,
  * tryb otwarcia pliku --- również napis,
    * `"r"` --- tylko do odczytu, znacznik na początku pliku,
    * `"r+"` --- do odczytu i zapisu,
      znacznik na początku pliku,
    * `"w"` --- tylko do zapisu,
      czyszczenie pliku (jeśli istniał),
      znacznik na początku pliku,
    * `"w+"` --- do odczytu i zapisu,
      czyszczenie pliku (jeśli istniał),
      znacznik na początku pliku,
    * `"a"` --- (tryb dopisywania ---  _"appending"_)
      tylko do zapisu,
      znacznik na końcu pliku,
    * `"a+"` ---
      do odczytu i zapisu,
      znacznik na końcu pliku.

Funkcja `fopen` zwraca uchwyt do otwartego pliku,
jeśli czynność się powiodła.
W przeciwnym razie zwracana jest wartość `NULL`.

    FILE * f;
    f = fopen("program.c", "r");
    if(!f){
      perror("fopen");
      exit(1);
    }

Funkcja `perror` wypisuje przyczynę wystąpienia błędu
na standardowe wyjście błędów.

Gdy już zakończymy wszystkie działania na pliku,
należy go koniecznie zamknąć za pomocą funkcji `fclose`.

    fclose(f);

Standardowe wejście, wyjście i wyjście błędów
-------------------------
Najczęściej w programie w momencie uruchamiania
dostępne są trzy otwarte pliki:
`stdin`, `stdout`, `stderr`.
Pierwszy do odczytu, dwa pozostałe do zapisu.
Można ich używać jak zwykłych plików,
przy czym najczęściej są powiązane
z wejściem z klawiatury
oraz wyjściem na ekran.

Czytanie z pliku
-------------------------
Mając otwarty do odczytu plik,
możemy z niego czytać dane.

Funkcja `fscanf` działa analogicznie
do funkcji `scanf`, przy czym różnica
polega na tym, że jawnie podajemy,
z jakiego pliku ma się odbywać czytanie.

    int zmienna, wczytano;
    wczytano = fscanf(f, "%d", &zmienna);
    if(!wczytano){
      fprintf(stderr, "W pliku nie znaleziono liczby.\n");
    } else {
      printf("Wczytana z pliku liczba to %d.", zmienna);
    }

Znanej nam już funkcji `fgets` używamy
do wczytywania całych linii tekstu.

    char napis[100];
    fgets(napis, 100, f);
    printf("Wczytano linię: '%s'", napis);

Do wczytywania pojedynczych znaków
możemy użyć funkcji `fgetc`.

    int znak;
    znak = fgetc(f);
    if(znak == EOF){
      fprintf(stderr, "Został osiągnięty koniec pliku.\n");
    } else {
      printf("Wczytano znak '%c'.\n", znak);
    }

Warto zwrócić uwagę, że zmienna `znak` w powyższym
przykładzie jest typu `int`.
Tylko wtedy porównywanie jej wartości do `EOF` ma sens,
ponieważ wartość `EOF` jest spoza zakresu typu `char`.

Zapisywanie do pliku
-------------------------

Analogicznie do funkcji `printf`
działa funkcja `fprintf`

    fprintf(f, "%d %d\n", a, b);

Funkcja `fputs` zapisuje do pliku
zawartość napisu.

    fputs(napis, f);

Aby zapisać do pliku pojedynczy znak,
możemy użyć funkcji `fputc`.

    fputc(znak, f);

Większy przykład
-------------------------
Poniższy program wypisuje na standardowe
wyjście zawartość pliku podanego
jako argument programu.

    #include <stdio.h>
    #include <stdlib.h>

    int main(int argc, char *argv[]){
      if(argc < 2){
        fprintf(
          stderr,
          "Podaj nazwę pliku jako argument programu.\n"
        );
        exit(1);
      }
      FILE * f = fopen(argv[1], "r");
      if(!f){
        perror("fopen");
        exit(2);
      }
      int znak;
      while((znak = fgetc(f)) != EOF)
        fputc(znak, stdout);
      fclose(f);
      return 0;
    }

Zadania
-------------------------

1.  Napisz program, który wypisze
    liczbę znaków w pliku,
    którego nazwa jest podana jako
    parametr wywołania programu.

2.  Napisz program, który jest uruchamiany
    z dwoma parametrami --- nazwami plików.
    Program ma kopiować pierwszy plik do drugiego.
